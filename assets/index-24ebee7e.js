import{O as x,r as l,b as S,P as B,L as D,a0 as H}from"./index-39306e86.js";import{c as L}from"./index-01a4db43.js";const M=e=>e,I=(e,s)=>e(s);function J(e){return e?H(e)?e:L:M}function N(e){return e?H(e)?e:L:M}function k(e,s={}){const[i,O]=x(e),{clone:m=!1,dump:P=J(m),parse:U=N(m),setSource:V=I}=s;function p(){return{snapshot:P(i()),timestamp:D()}}const[r,d]=l(p()),[a,o]=l([]),[c,u]=l([]),f=t=>{V(O,U(t.snapshot)),d(t)},h=()=>{o(t=>[r(),...t]),d(p()),s.capacity&&a().length>s.capacity&&o(([...t])=>(t.splice(s.capacity,1/0),t)),c().length&&u(([...t])=>(t.splice(0,c().length),t))},g=()=>{o([]),u([])},_=()=>{const t=a()[0];o(([...n])=>(n.shift(),n)),t&&(u(n=>[r(),...n]),f(t))},b=()=>{const t=c()[0];u(([...n])=>(n.shift(),n)),t&&(o(n=>[r(),...n]),f(t))},v=()=>{f(r())},y=S(()=>[r(),...a()]),R=S(()=>a().length>0),F=S(()=>c().length>0);return B(e)?{source:i,undoStack:a,redoStack:c,last:r,history:y,canUndo:R,canRedo:F,clear:g,commit:h,reset:v,undo:_,redo:b}:{source:i,undoStack:a,redoStack:c,last:r,history:y,canUndo:R,canRedo:F,clear:g,commit:h}}export{k as u};
